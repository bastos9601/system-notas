{% extends "admin/base_admin.html" %}

{% block title %}Crear Usuario para Docente - Sistema de Notas{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="fas fa-user-plus"></i> Crear Usuario para Docente</h1>
    <p>Asocia un usuario a un docente existente para que pueda acceder al sistema</p>
</div>

<div class="content-container">
    <div class="form-section">
        <div class="section-header">
            <i class="fas fa-user-plus"></i>
            <h3>Información del Usuario</h3>
        </div>

        <form method="POST" action="{{ url_for('crear_usuario_docente') }}">
            <div class="form-group">
                <label for="docente_id" class="form-label">Seleccionar Docente *</label>
                <select class="form-control" id="docente_id" name="docente_id" required>
                    <option value="">-- Seleccionar Docente --</option>
                    {% for docente in docentes %}
                    <option value="{{ docente.id }}">
                        {{ docente.nombre }} {{ docente.apellido }} - DNI: {{ docente.dni }} - {{ docente.especialidad or 'Sin especialidad' }}
                    </option>
                    {% endfor %}
                </select>
                <small class="form-text">
                    Solo se muestran docentes que no tienen usuario asociado.
                </small>
            </div>

            <div class="form-group">
                <label for="username" class="form-label">Nombre de Usuario *</label>
                <input type="text" class="form-control" id="username" name="username" required>
                <small class="form-text">
                    El nombre de usuario debe ser único en el sistema.
                </small>
            </div>

            <div class="form-group">
                <label for="password" class="form-label">Contraseña *</label>
                <div class="password-input-container">
                    <input type="password" class="form-control" id="password" name="password" required>
                    <button type="button" class="password-toggle" id="passwordToggle">
                        <i class="fas fa-eye" id="passwordIcon"></i>
                    </button>
                </div>
                <small class="form-text">
                    La contraseña será encriptada y almacenada de forma segura.
                </small>
            </div>

            <div class="form-group">
                <label for="confirm_password" class="form-label">Confirmar Contraseña *</label>
                <div class="password-input-container">
                    <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
                    <button type="button" class="password-toggle" id="confirmPasswordToggle">
                        <i class="fas fa-eye" id="confirmPasswordIcon"></i>
                    </button>
                </div>
            </div>

            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <strong>Información:</strong> Al crear este usuario, el docente podrá acceder al sistema con sus credenciales y gestionar sus materias y notas en el panel de docente.
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Crear Usuario
                </button>
                <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Volver al Dashboard
                </a>
            </div>
        </form>
    </div>

    <div class="info-section">
        <div class="section-header">
            <i class="fas fa-info-circle"></i>
            <h3>Docentes Disponibles</h3>
        </div>
        <p class="info-text">
            Se muestran solo los docentes que no tienen un usuario asociado.
        </p>
        
        {% if docentes %}
        <div class="table-responsive">
            <table class="info-table">
                <thead>
                    <tr>
                        <th>Docente</th>
                        <th>Especialidad</th>
                        <th>DNI</th>
                    </tr>
                </thead>
                <tbody>
                    {% for docente in docentes %}
                    <tr>
                        <td>
                            <strong>{{ docente.nombre }} {{ docente.apellido }}</strong>
                        </td>
                        <td>
                            <span class="badge badge-info">{{ docente.especialidad or 'Sin especialidad' }}</span>
                        </td>
                        <td>
                            <span class="dni-text">{{ docente.dni }}</span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle"></i>
            No hay docentes disponibles para crear usuario.
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.form-section {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 25px;
}

.info-section {
    background: #ffffff;
    border: 1px solid #e9ecef;
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 25px;
}

.section-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid #e9ecef;
}

.section-header i {
    font-size: 20px;
    color: #007bff;
    width: 24px;
    text-align: center;
}

.section-header h3 {
    margin: 0;
    color: #2c3e50;
    font-size: 18px;
    font-weight: 600;
}

.form-group {
    margin-bottom: 20px;
}

.form-label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #2c3e50;
    font-size: 14px;
}

.form-control {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #e1e5e9;
    border-radius: 8px;
    font-size: 14px;
    transition: all 0.3s ease;
    background-color: #fff;
    max-width: 500px;
}

.form-control:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
    background-color: #fff;
}

.form-control:hover {
    border-color: #ced4da;
}

.form-text {
    display: block;
    margin-top: 5px;
    font-size: 12px;
    color: #6c757d;
    font-style: italic;
}

.password-input-container {
    position: relative;
    display: flex;
    align-items: center;
    max-width: 500px;
}

.password-input-container .form-control {
    padding-right: 50px;
}

.password-toggle {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: #6c757d;
    cursor: pointer;
    padding: 5px;
    border-radius: 4px;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 30px;
    height: 30px;
}

.password-toggle:hover {
    color: #007bff;
    background-color: rgba(0, 123, 255, 0.1);
}

.password-toggle i {
    font-size: 16px;
}

.alert {
    border-radius: 8px;
    border: none;
    padding: 15px;
    margin-bottom: 20px;
    max-width: 500px;
}

.alert-info {
    background: rgba(0, 123, 255, 0.1);
    color: #2c3e50;
    border-left: 4px solid #007bff;
}

.alert-warning {
    background: rgba(255, 193, 7, 0.1);
    color: #856404;
    border-left: 4px solid #ffc107;
}

.form-actions {
    display: flex;
    gap: 15px;
    margin-top: 30px;
    padding-top: 25px;
    border-top: 2px solid #e9ecef;
}

.btn {
    padding: 12px 30px;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 140px;
    justify-content: center;
}

.btn-primary {
    background: linear-gradient(135deg, #007bff, #0056b3);
    color: white;
    box-shadow: 0 2px 4px rgba(0, 123, 255, 0.2);
}

.btn-primary:hover {
    background: linear-gradient(135deg, #0056b3, #004085);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);
}

.btn-secondary {
    background: linear-gradient(135deg, #6c757d, #545b62);
    color: white;
    box-shadow: 0 2px 4px rgba(108, 117, 125, 0.2);
}

.btn-secondary:hover {
    background: linear-gradient(135deg, #545b62, #495057);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(108, 117, 125, 0.3);
}

.info-text {
    color: #6c757d;
    margin-bottom: 20px;
    font-size: 14px;
}

.info-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}

.info-table th {
    background: #f8f9fa;
    color: #495057;
    font-weight: 600;
    padding: 12px;
    text-align: left;
    border-bottom: 2px solid #e9ecef;
}

.info-table td {
    padding: 12px;
    border-bottom: 1px solid #e9ecef;
    vertical-align: middle;
}

.badge {
    font-size: 0.8rem;
    padding: 6px 12px;
    border-radius: 20px;
}

.badge-info {
    background: rgba(0, 123, 255, 0.1);
    color: #007bff;
}

.dni-text {
    font-family: monospace;
    font-size: 0.9rem;
    color: #6c757d;
}

@media (max-width: 768px) {
    .form-actions {
        flex-direction: column;
        align-items: center;
    }
    
    .btn {
        width: 100%;
        max-width: 300px;
    }
    
    .form-section, .info-section {
        padding: 20px;
    }
    
    .form-control {
        max-width: 100%;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirm_password');
    
    function validatePassword() {
        if (password.value !== confirmPassword.value) {
            confirmPassword.setCustomValidity('Las contraseñas no coinciden');
        } else {
            confirmPassword.setCustomValidity('');
        }
    }
    
    password.addEventListener('change', validatePassword);
    confirmPassword.addEventListener('keyup', validatePassword);

    // Funcionalidad para mostrar/ocultar contraseña
    const passwordToggle = document.getElementById('passwordToggle');
    const passwordIcon = document.getElementById('passwordIcon');
    const confirmPasswordToggle = document.getElementById('confirmPasswordToggle');
    const confirmPasswordIcon = document.getElementById('confirmPasswordIcon');

    passwordToggle.addEventListener('click', function() {
        if (password.type === 'password') {
            password.type = 'text';
            passwordIcon.classList.remove('fa-eye');
            passwordIcon.classList.add('fa-eye-slash');
        } else {
            password.type = 'password';
            passwordIcon.classList.remove('fa-eye-slash');
            passwordIcon.classList.add('fa-eye');
        }
    });

    confirmPasswordToggle.addEventListener('click', function() {
        if (confirmPassword.type === 'password') {
            confirmPassword.type = 'text';
            confirmPasswordIcon.classList.remove('fa-eye');
            confirmPasswordIcon.classList.add('fa-eye-slash');
        } else {
            confirmPassword.type = 'password';
            confirmPasswordIcon.classList.remove('fa-eye-slash');
            confirmPasswordIcon.classList.add('fa-eye');
        }
    });
});
</script>
{% endblock %}
